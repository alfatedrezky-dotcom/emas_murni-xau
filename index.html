<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SMC ULTRA-PRECISION TERMINAL</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <style>
        :root { --bg: #050505; --panel: #111; --gold: #ffd700; --buy: #00ff88; --sell: #ff4444; }
        body { background: var(--bg); color: #fff; font-family: 'Segoe UI', sans-serif; margin: 0; padding: 10px; }
        .dashboard { display: grid; grid-template-columns: 300px 1fr 300px; gap: 15px; height: 95vh; }
        .panel { background: var(--panel); border: 1px solid #222; border-radius: 12px; padding: 20px; display: flex; flex-direction: column; box-shadow: 0 10px 30px rgba(0,0,0,0.5); }
        
        /* Price Display */
        #price { font-size: 56px; font-weight: 800; text-align: center; color: var(--gold); letter-spacing: -2px; margin: 10px 0; transition: 0.3s; }
        .price-up { color: var(--buy) !important; text-shadow: 0 0 20px rgba(0,255,136,0.4); }
        .price-down { color: var(--sell) !important; text-shadow: 0 0 20px rgba(255,68,68,0.4); }

        /* Signal Box */
        .signal-card { padding: 15px; border-radius: 8px; text-align: center; font-weight: bold; font-size: 18px; border: 1px solid #333; margin-bottom: 20px; text-transform: uppercase; }
        .sig-buy { background: rgba(0,255,136,0.1); border-color: var(--buy); color: var(--buy); }
        .sig-sell { background: rgba(255,68,68,0.1); border-color: var(--sell); color: var(--sell); }

        /* Ledger & Log */
        .scroll-area { flex-grow: 1; overflow-y: auto; font-size: 12px; padding-right: 5px; }
        .log-item { padding: 8px; border-bottom: 1px solid #222; display: flex; justify-content: space-between; }
        .status-dot { height: 8px; width: 8px; border-radius: 50%; display: inline-block; margin-right: 5px; }
        
        input, button { width: 100%; padding: 12px; margin: 5px 0; border-radius: 6px; border: none; font-weight: bold; }
        input { background: #1a1a1a; color: #fff; border: 1px solid #333; }
        .btn-in { background: var(--buy); color: #000; }
        .btn-out { background: var(--sell); color: #fff; }
    </style>
</head>
<body>

<div class="dashboard">
    <div class="panel">
        <h3 style="color: var(--gold); margin-top: 0;">FINANCE LEDGER</h3>
        <h2 id="balance" style="font-size: 28px; margin: 10px 0;">Rp 0</h2>
        <input type="text" id="desc" placeholder="Keterangan Transaksi">
        <input type="number" id="amt" placeholder="Jumlah (Rp)">
        <button class="btn-in" onclick="addTx('IN')">DEPOSIT (+)</button>
        <button class="btn-out" onclick="addTx('OUT')">WITHDRAW (-)</button>
        <div class="scroll-area" id="tx-hist" style="margin-top: 15px;"></div>
    </div>

    <div class="panel" style="justify-content: center;">
        <div style="text-align: center; color: #666; font-size: 12px; letter-spacing: 2px;">XAU/USD LIVE TRACKER</div>
        <div id="price">0000.00</div>
        <div id="signal-box" class="signal-card">INITIALIZING ENGINE...</div>
        <div style="height: 300px; border: 1px dashed #333; border-radius: 8px; display: flex; align-items: center; justify-content: center; color: #444;">
            [ CHART AREA - READY ]
        </div>
    </div>

    <div class="panel">
        <h3 style="color: var(--gold); margin-top: 0;">SIGNAL & NEWS LOG</h3>
        <div class="scroll-area" id="news-log">
            <div class="log-item" style="color: var(--buy);">[SYSTEM] Engine Connected</div>
        </div>
    </div>
</div>

<script>
    // Konfigurasi Database Sesuai Foto Kamu
    const conf = { databaseURL: "https://emas-murni-xau-default-rtdb.firebaseio.com" };
    firebase.initializeApp(conf);
    const db = firebase.database();

    let lastPrice = 0;
    let records = JSON.parse(localStorage.getItem('smc_finance')) || [];

    // Main Price Listener
    db.ref('live_monitor').on('value', (snap) => {
        const data = snap.val();
        if(!data || !data.price) return;

        const p = data.price;
        const priceEl = document.getElementById('price');
        const sigEl = document.getElementById('signal-box');
        
        // Update Price & Animation
        priceEl.innerText = p.toFixed(2);
        priceEl.className = p > lastPrice ? 'price-up' : 'price-down';

        // Signal Logic (Accurate Momentum)
        if(lastPrice > 0 && p !== lastPrice) {
            const side = p > lastPrice ? 'BUY' : 'SELL';
            sigEl.innerText = side + " MOMENTUM CONFIRMED";
            sigEl.className = "signal-card " + (side === 'BUY' ? 'sig-buy' : 'sig-sell');
            
            // Log Signal as News
            addLog(side, p);
        }

        lastPrice = p;
    });

    function addLog(side, price) {
        const log = document.getElementById('news-log');
        const time = new Date().toLocaleTimeString();
        const color = side === 'BUY' ? '#00ff88' : '#ff4444';
        log.innerHTML = `<div class="log-item"><span style="color:${color}">[${side}]</span> <span>$${price}</span> <span style="color:#666">${time}</span></div>` + log.innerHTML;
    }

    function addTx(type) {
        const d = document.getElementById('desc').value;
        const a = parseFloat(document.getElementById('amt').value);
        if(!d || isNaN(a)) return;
        records.push({ d, a, type, t: new Date().toLocaleString() });
        localStorage.setItem('smc_finance', JSON.stringify(records));
        renderFin();
    }

    function renderFin() {
        let total = 0;
        const h = document.getElementById('tx-hist');
        h.innerHTML = '';
        records.forEach(i => {
            total += (i.type === 'IN' ? i.a : -i.a);
            h.innerHTML = `<div class="log-item"><span>${i.d}</span> <span style="color:${i.type=='IN'?'#00ff88':'#ff4444'}">Rp ${i.a.toLocaleString()}</span></div>` + h.innerHTML;
        });
        document.getElementById('balance').innerText = "Rp " + total.toLocaleString();
    }
    renderFin();
</script>
</body>
</html>
