<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SECURE COMMAND CENTER | PERMANENT LEDGER</title>
    <style>
        :root { --neon: #00ff88; --danger: #ff4444; --gold: #ffd700; --panel: #0d0d0d; --bg: #020202; }
        * { box-sizing: border-box; }
        body { background: var(--bg); color: #eee; font-family: 'Inter', sans-serif; margin: 0; overflow: hidden; height: 100vh; padding: 15px; }
        
        .desktop-wrapper { 
            display: grid; 
            grid-template-columns: 320px 1fr 320px; 
            grid-template-rows: auto 1fr 280px; 
            gap: 15px; 
            height: 100%; 
        }

        .panel { background: var(--panel); border: 1px solid #1a1a1a; border-radius: 12px; padding: 15px; display: flex; flex-direction: column; position: relative; }
        .header-title { font-size: 10px; color: #555; letter-spacing: 2px; text-transform: uppercase; border-bottom: 1px solid #1a1a1a; padding-bottom: 8px; margin-bottom: 15px; display: block; }

        /* Timer Indicator */
        .timer-bar { height: 3px; background: #222; width: 100%; margin-top: 5px; }
        #timer-progress { height: 100%; background: var(--neon); width: 0%; transition: linear 1s; }

        /* Main Center Monitor */
        .main-monitor { grid-column: 2; grid-row: 1 / 3; justify-content: center; align-items: center; border: 1px solid #333; }
        #price { font-size: 85px; font-weight: 900; font-family: 'Courier New'; letter-spacing: -5px; margin: 5px 0; }
        .signal-banner { width: 100%; padding: 25px; border-radius: 10px; font-size: 28px; font-weight: 900; text-align: center; border: 2px solid #222; margin: 15px 0; }
        .buy-mode { background: rgba(0, 255, 136, 0.1); color: var(--neon); border-color: var(--neon); }
        .sell-mode { background: rgba(255, 68, 68, 0.1); color: var(--danger); border-color: var(--danger); }

        /* Finance Section */
        .finance-grid { grid-column: 1 / 4; grid-row: 3; display: grid; grid-template-columns: 1fr 1fr 1.5fr; gap: 15px; }
        input { background: #111; border: 1px solid #333; color: #fff; padding: 10px; border-radius: 5px; width: 100%; margin-bottom: 10px; font-size: 12px; }
        .btn-lock { background: var(--neon); color: #000; border: none; padding: 12px; border-radius: 5px; font-weight: bold; cursor: pointer; width: 100%; text-transform: uppercase; font-size: 10px; }
        
        .ledger-item { display: flex; justify-content: space-between; font-size: 11px; padding: 8px 0; border-bottom: 1px solid #151515; }
        .scroll { overflow-y: auto; scrollbar-width: thin; scrollbar-color: #333 transparent; }
        
        .report-box { background: #111; border-radius: 8px; padding: 10px; margin-top: 10px; }
        .locked-badge { font-size: 8px; color: #444; margin-top: 5px; text-align: center; display: block; }
    </style>
</head>
<body oncontextmenu="return false;">

<div class="desktop-wrapper">
    
    <div class="panel">
        <span class="header-title">Cycle Intelligence</span>
        <div style="display:flex; justify-content:space-between; font-size:11px;">
            <span>Next Signal:</span><span id="seconds">60</span>s
        </div>
        <div class="timer-bar"><div id="timer-progress"></div></div>
        
        <span class="header-title" style="margin-top:30px;">Monthly Finance Summary</span>
        <div class="report-box">
            <div style="font-size:9px; color:#555;">ESTIMATED 30-DAY PROFIT/LOSS</div>
            <div id="monthly-pl" style="font-size:20px; font-weight:bold; color:var(--gold);">Rp 0</div>
            <div style="height:1px; background:#222; margin:10px 0;"></div>
            <div style="font-size:10px; display:flex; justify-content:space-between;">
                <span>Inflow:</span><span id="mon-in" style="color:var(--neon)">0</span>
            </div>
            <div style="font-size:10px; display:flex; justify-content:space-between; margin-top:5px;">
                <span>Outflow:</span><span id="mon-out" style="color:var(--danger)">0</span>
            </div>
        </div>
    </div>

    <div class="panel main-monitor">
        <div style="font-size:10px; color:#444;">XAUUSD QUANTUM ENGINE</div>
        <div id="price">5057.00</div>
        <div id="signal-box" class="signal-banner">SYNCHRONIZING...</div>
        <div style="display:grid; grid-template-columns: 1fr 1fr; gap: 20px; width: 100%;">
            <div style="text-align:center; background:#111; padding:15px; border-radius:8px;">
                <span style="font-size:9px; color:#555;">TARGET EXIT</span>
                <span id="tp-price" style="font-size:24px; font-weight:bold; color:var(--neon)">---</span>
            </div>
            <div style="text-align:center; background:#111; padding:15px; border-radius:8px;">
                <span style="font-size:9px; color:#555;">PROTECTION</span>
                <span id="sl-price" style="font-size:24px; font-weight:bold; color:var(--danger)">---</span>
            </div>
        </div>
    </div>

    <div class="panel">
        <span class="header-title">Signal History (M1)</span>
        <div id="trade-log" class="scroll" style="color:#666; font-size:10px; height:100%;"></div>
    </div>

    <div class="finance-grid">
        <div class="panel">
            <span class="header-title">Permanent Ledger Entry</span>
            <input type="text" id="fin-desc" placeholder="Keterangan Transaksi">
            <input type="number" id="fin-amount" placeholder="Jumlah (Rp)">
            <div style="display:flex; gap:10px;">
                <button class="btn-lock" onclick="saveFinance('IN')">Record Income (+)</button>
                <button class="btn-lock" style="background:var(--danger)" onclick="saveFinance('OUT')">Record Expense (-)</button>
            </div>
            <span class="locked-badge">ðŸ”’ DATA CANNOT BE EDITED ONCE SAVED</span>
        </div>
        <div class="panel">
            <span class="header-title">Live Balance Dashboard</span>
            <div style="font-size:32px; font-weight:bold; color:var(--gold);" id="total-balance">Rp 0</div>
            <div style="font-size:11px; margin-top:15px; display:flex; gap:20px;">
                <div><span style="color:#555">TOTAL IN</span><br><span id="total-in" style="color:var(--neon); font-weight:bold;">0</span></div>
                <div><span style="color:#555">TOTAL OUT</span><br><span id="total-out" style="color:var(--danger); font-weight:bold;">0</span></div>
            </div>
        </div>
        <div class="panel scroll">
            <span class="header-title">Immutable Transaction History</span>
            <div id="fin-history"></div>
        </div>
    </div>
</div>

<script>
    let price = 5057.00;
    let secondsLeft = 60;
    let financeData = JSON.parse(localStorage.getItem('trading_ledger')) || [];

    // Load data awal
    updateFinanceUI();

    // Price Engine
    setInterval(() => {
        price += (Math.random() * 0.12) - 0.06;
        document.getElementById('price').innerText = price.toFixed(2);
    }, 300);

    // M1 Signal Timer
    setInterval(() => {
        secondsLeft--;
        document.getElementById('seconds').innerText = secondsLeft;
        document.getElementById('timer-progress').style.width = ((60 - secondsLeft) / 60 * 100) + "%";
        if (secondsLeft <= 0) {
            const side = Math.random() > 0.5 ? 'BUY' : 'SELL';
            const box = document.getElementById('signal-box');
            box.innerText = `M1 ${side} CONFIRMED`;
            box.className = `signal-banner ${side === 'BUY' ? 'buy-mode' : 'sell-mode'}`;
            document.getElementById('tp-price').innerText = (side === 'BUY' ? price + 1.25 : price - 1.25).toFixed(2);
            document.getElementById('sl-price').innerText = (side === 'BUY' ? price - 0.75 : price + 0.75).toFixed(2);
            
            const log = document.getElementById('trade-log');
            log.innerHTML = `<div class='ledger-item'><span>[${new Date().toLocaleTimeString()}] ${side}</span><span>${price.toFixed(2)}</span></div>` + log.innerHTML;
            secondsLeft = 60;
        }
    }, 1000);

    // Immutable Finance Logic
    function saveFinance(type) {
        const desc = document.getElementById('fin-desc').value;
        const amt = parseFloat(document.getElementById('fin-amount').value);
        if(!desc || !amt) return alert("Isi data dengan lengkap!");

        const entry = {
            id: Date.now(),
            date: new Date().toISOString(),
            desc: desc,
            amount: amt,
            type: type
        };

        financeData.push(entry);
        localStorage.setItem('trading_ledger', JSON.stringify(financeData));
        
        document.getElementById('fin-desc').value = '';
        document.getElementById('fin-amount').value = '';
        updateFinanceUI();
    }

    function updateFinanceUI() {
        let bal = 0, tin = 0, tout = 0;
        const historyEl = document.getElementById('fin-history');
        historyEl.innerHTML = '';

        // Hitung Monthly (30 Hari Terakhir)
        const thirtyDaysAgo = Date.now() - (30 * 24 * 60 * 60 * 1000);
        let mIn = 0, mOut = 0;

        financeData.forEach(item => {
            if(item.type === 'IN') { bal += item.amount; tin += item.amount; }
            else { bal -= item.amount; tout += item.amount; }

            if(new Date(item.date).getTime() > thirtyDaysAgo) {
                if(item.type === 'IN') mIn += item.amount;
                else mOut += item.amount;
            }

            const div = document.createElement('div');
            div.className = 'ledger-item';
            div.innerHTML = `<span>${item.desc}</span><span style="color:${item.type==='IN'?'var(--neon)':'var(--danger)'}">${item.type==='IN'?'+':'-'} ${item.amount.toLocaleString()}</span>`;
            historyEl.prepend(div);
        });

        document.getElementById('total-balance').innerText = `Rp ${bal.toLocaleString()}`;
        document.getElementById('total-in').innerText = tin.toLocaleString();
        document.getElementById('total-out').innerText = tout.toLocaleString();
        
        // Monthly Report UI
        document.getElementById('monthly-pl').innerText = `Rp ${(mIn - mOut).toLocaleString()}`;
        document.getElementById('mon-in').innerText = mIn.toLocaleString();
        document.getElementById('mon-out').innerText = mOut.toLocaleString();
    }
</script>
</body>
</html>
