<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <title>SMC ULTRA-PRECISION | FIXED</title>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-app.js"></script>
    <script src="https://www.gstatic.com/firebasejs/8.10.0/firebase-database.js"></script>
    <script src="https://unpkg.com/lightweight-charts/dist/lightweight-charts.standalone.production.js"></script>
    <style>
        body { background: #000; color: #fff; font-family: sans-serif; margin: 0; padding: 10px; overflow: hidden; }
        .grid { display: grid; grid-template-columns: 280px 1fr 280px; gap: 10px; height: 95vh; }
        .panel { background: #0a0a0a; border: 1px solid #1a1a1a; border-radius: 8px; padding: 15px; display: flex; flex-direction: column; }
        #price { font-size: 45px; font-weight: bold; text-align: center; color: #ffd700; text-shadow: 0 0 10px rgba(255,215,0,0.5); }
        .sig-box { padding: 10px; border-radius: 5px; text-align: center; font-weight: bold; border: 1px solid #333; margin: 10px 0; }
        .buy { border-color: #00ff88; color: #00ff88; background: rgba(0,255,136,0.1); }
        .sell { border-color: #ff4444; color: #ff4444; background: rgba(255,68,68,0.1); }
        .scroll { flex-grow: 1; overflow-y: auto; font-size: 11px; border-top: 1px solid #222; margin-top: 10px; }
    </style>
</head>
<body>
<div class="grid">
    <div class="panel">
        <h2 id="balance">Rp 0</h2>
        <div id="hist" class="scroll"></div>
    </div>
    <div class="panel">
        <div id="price">LOADING...</div>
        <div id="sig" class="sig-box">WAITING FOR TERMUX...</div>
        <div id="chart" style="height: 400px;"></div>
    </div>
    <div class="panel">
        <div id="log" class="scroll"></div>
    </div>
</div>

<script>
    // Konfigurasi Database Anda
    const conf = { databaseURL: "https://emas_murni-xau-default-rtdb.firebaseio.com" };
    firebase.initializeApp(conf);
    const db = firebase.database();

    const chart = LightweightCharts.createChart(document.getElementById('chart'), {
        layout: { backgroundColor: '#0a0a0a', textColor: '#d1d4dc' },
        grid: { vertLines: { color: '#111' }, horzLines: { color: '#111' } }
    });
    const candle = chart.addCandlestickSeries({ upColor: '#00ff88', downColor: '#ff4444' });
    let lastP = 0;

    // Perbaikan Listener: Membaca folder 'live_monitor' ATAU 'root'
    db.ref('/').on('value', (s) => {
        const root = s.val();
        // Cek apakah data ada di dalam 'live_monitor' atau langsung di root
        const val = root.live_monitor ? root.live_monitor : root;
        
        if(!val || !val.price) {
            document.getElementById('sig').innerText = "DATABASE EMPTY / WRONG PATH";
            return;
        }

        const p = parseFloat(val.price);
        document.getElementById('price').innerText = p.toFixed(2);
        document.getElementById('price').style.color = p > lastP ? '#00ff88' : '#ff4444';

        if(lastP > 0 && p !== lastP) {
            const side = p > lastP ? 'BUY' : 'SELL';
            const sigEl = document.getElementById('sig');
            sigEl.innerText = side + " CONFIRMED";
            sigEl.className = "sig-box " + side.toLowerCase();
            document.getElementById('log').innerHTML = "<div>[" + new Date().toLocaleTimeString() + "] " + side + " @ " + p + "</div>" + document.getElementById('log').innerHTML;
        }

        candle.update({ 
            time: val.timestamp ? Math.floor(val.timestamp) : Math.floor(Date.now()/1000), 
            open: p, high: p, low: p, close: p 
        });
        lastP = p;
    });
</script>
</body>
</html>
