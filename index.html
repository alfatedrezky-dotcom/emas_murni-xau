// Konfigurasi Database sesuai data Termux
const firebaseConfig = { 
    databaseURL: "https://emas_murni-xau-default-rtdb.firebaseio.com" 
};
firebase.initializeApp(firebaseConfig);
const db = firebase.database();

// Inisialisasi Chart Candlestick
const chart = LightweightCharts.createChart(document.getElementById('chart'), {
    layout: { backgroundColor: '#0d0d0d', textColor: '#d1d4dc' },
    grid: { vertLines: { color: '#1a1a1a' }, horzLines: { color: '#1a1a1a' } }
});
const candleSeries = chart.addCandlestickSeries({ upColor: '#00ff88', downColor: '#ff4444' });

let lastPrice = 0;

// Listener Real-Time
db.ref('live_monitor').on('value', (snapshot) => {
    const data = snapshot.val();
    if (data && data.price) {
        const p = data.price;
        const ts = Math.floor(data.timestamp);

        // Update Tampilan Harga
        const priceEl = document.getElementById('price');
        priceEl.innerText = p.toFixed(2);
        priceEl.style.color = p > lastPrice ? '#00ff88' : '#ff4444';

        // Update Sinyal BUY/SELL
        if (lastPrice > 0 && p !== lastPrice) {
            const side = p > lastPrice ? 'BUY' : 'SELL';
            const sigBox = document.getElementById('signal');
            sigBox.innerText = side + " CONFIRMED";
            sigBox.className = "signal-box " + side.toLowerCase();
            
            // Log Sinyal ke Panel
            const logEl = document.getElementById('log');
            logEl.innerHTML = `<div>[${new Date().toLocaleTimeString()}] ${side} @ ${p}</div>` + logEl.innerHTML;
        }

        // Gambar pergerakan grafik
        candleSeries.update({ time: ts, open: p, high: p, low: p, close: p });
        lastPrice = p;
    }
});
